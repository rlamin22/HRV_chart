<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRV & 활동량 분석 그래프</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f4f6f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* height 대신 min-height 사용 (모바일 가로모드 대응) */
            margin: 0;
            padding: 20px; /* 모바일에서 테두리 여백 확보 */
            box-sizing: border-box;
        }

        .chart-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
            /* 중요: 차트 높이를 반응형으로 제어하기 위해 상대 높이 지정 */
            height: 60vh; 
            min-height: 400px; /* 너무 작아지지 않도록 최소 높이 설정 */
            position: relative;
            display: flex;
            flex-direction: column;
        }

        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        /* --- 모바일 전용 스타일 (600px 이하) --- */
        @media (max-width: 600px) {
            body {
                padding: 10px; /* 바디 여백 축소 */
            }
            .chart-container {
                padding: 15px; /* 컨테이너 내부 여백 축소 */
                height: 50vh; /* 모바일에서는 높이 비율 조정 */
                min-height: 350px;
            }
            h2 {
                font-size: 1.1rem; /* 제목 크기 축소 */
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>

<div class="chart-container">
    <h2>일일 활동량 및 HRV 패턴</h2>
    <div style="flex-grow: 1; position: relative; width: 100%; overflow: hidden;">
        <canvas id="bioChart"></canvas>
    </div>
</div>

<script>
    const ctx = document.getElementById('bioChart').getContext('2d');

    const hours = Array.from({length: 24}, (_, i) => `${i}시`);
    
    const activityData = [
        0, 0, 0, 0, 0, 0,  
        10, 30, 80, 45, 20, 30, 
        60, 40, 25, 20, 90, 85, 
        50, 20, 10, 5, 0        
    ];

    const hrvData = [
        75, 78, 80, 82, 80, 75, 
        60, 50, 35, 45, 55, 50, 
        40, 50, 55, 60, 30, 32, 
        45, 60, 65, 70, 72      
    ];

    const bioChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: hours,
            datasets: [
                {
                    label: '활동량',
                    data: activityData,
                    backgroundColor: '#429C34',
                    borderRadius: 4,
                    order: 2,
                    yAxisID: 'y',
                },
                {
                    label: 'HRV',
                    data: hrvData,
                    type: 'line',
                    borderColor: '#2C3E50',
                    backgroundColor: 'rgba(44, 62, 80, 0.1)',
                    borderWidth: 3,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#2C3E50',
                    pointRadius: 3, // 모바일에서 점이 너무 크지 않도록 약간 축소
                    tension: 0.4,
                    order: 1,
                    yAxisID: 'y1',
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false, // [핵심] 부모 컨테이너 높이에 맞춰 꽉 채움
            interaction: {
                mode: 'index',
                intersect: false,
            },
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        boxWidth: 12, // 범례 박스 크기 축소 (모바일 공간 확보)
                        padding: 10,
                        font: {
                            size: 12 // 범례 폰트 사이즈 조정
                        }
                    }
                },
                tooltip: {
                    enabled: true,
                    bodyFont: { size: 13 },
                    titleFont: { size: 13 }
                }
            },
            scales: {
                x: {
                    grid: { display: false },
                    ticks: {
                        autoSkip: true, // [핵심] 공간이 부족하면 라벨 자동 건너뛰기
                        maxRotation: 0, // 라벨 기울임 방지
                        font: {
                            size: 11 // X축 글씨 크기
                        }
                    }
                },
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    title: {
                        display: true,
                        text: '활동량',
                        font: { size: 11 } // 모바일에 맞춰 폰트 조정
                    },
                    grid: { display: false },
                    ticks: { font: { size: 10 } }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: 'HRV (ms)',
                        font: { size: 11 }
                    },
                    grid: {
                        borderDash: [5, 5],
                        color: '#e0e0e0'
                    },
                    ticks: { font: { size: 10 } }
                }
            }
        }
    });
</script>

</body>
</html>